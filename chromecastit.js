!function(){function e(e){console.log(e)}function t(e){console.log(e)}function n(){var e=new chrome.cast.ApiConfig(new chrome.cast.SessionRequest(chrome.cast.media.DEFAULT_MEDIA_RECEIVER_APP_ID),a.bind(null,function(){}),function(e){if("available"===e){console.log("receiver found");var t=JSON.parse(localStorage.getItem("storedSession"));if(t){var n=t.timestamp,i=(new Date).getTime();i-n<y&&t&&(console.log("Found stored session id: "+t.id),chrome.cast.requestSessionById(t.id))}}else console.log("receiver not available")},chrome.cast.AutoJoinPolicy.ORIGIN_SCOPED);chrome.cast.initialize(e,function(){console.log("init success")},t)}function i(e){console.log("launching app"),chrome.cast.requestSession(a.bind(null,e),t)}function a(e,t){if(console.log("Got session: "+t.sessionId),v=t,"undefined"!=typeof Storage){var n={id:t.sessionId,timestamp:(new Date).getTime()};localStorage.setItem("storedSession",JSON.stringify(n))}0!=t.media.length&&l("onRequestSession",t.media[0]),t.addMediaListener(l.bind(this,"addMediaListener")),t.addUpdateListener(o.bind(this)),e()}function o(){v.status==chrome.cast.SessionStatus.STOPPED&&(v=null)}function s(n){v&&(n>0?v.setReceiverVolumeLevel(n,e.bind(this,"set-volume done"),t):v.setReceiverMuted(!0,e.bind(this,"mute done"),t))}function d(e,n,i){if(!v)return void console.log("no session");var a=new chrome.cast.media.MediaInfo(n);a.metadata=new chrome.cast.media.GenericMediaMetadata,a.metadata.metadataType=chrome.cast.media.MetadataType.GENERIC,a.contentType="video/mp4",a.metadata.title=e,a.metadata.images=[{url:i}];var o=new chrome.cast.media.LoadRequest(a);o.autoplay=!0,o.currentTime=0,v.loadMedia(o,l.bind(this,"loadMedia"),t)}function l(e,t){console.log("new media session ID:"+t.mediaSessionId+" via ("+e+")"),g=t,t.addUpdateListener(c)}function c(e){e||(g=null)}function r(){g&&g.play(null,e.bind(this,"playing started for media "+g.sessionId),t)}function u(){g&&g.pause(null,e.bind("paused media "+g.sessionId),t)}function m(n){console.log("Seeking "+g.sessionId+":"+g.mediaSessionId+" to "+n+"%");var i=new chrome.cast.media.SeekRequest;i.currentTime=n*g.media.duration/100,g.seek(i,e.bind(this,"media seek done"),t)}function p(e){if(location.hostname.indexOf("bilibili.com")!=-1){var t=window.aid,n=document.title,i=new XMLHttpRequest;i.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var t=JSON.parse(this.responseText);e(n,t.src,t.img)}},i.open("GET","http://www.bilibili.com/m/html5?aid="+t+"&page=1",!0),i.send()}}function f(){var e=document.createElement("div");e.style.display="block",e.style.position="fixed",e.style.bottom="0px",e.style.left="0px",e.style.height="50vh",e.style.width="100vw",e.style["background-color"]="skyblue",e.style["z-index"]="99999";var t=document.createElement("button");t.innerHTML="Play",t.addEventListener("click",function(){v?p(function(e,t,n){d(e,t,n),r()}):i(function(){p(function(e,t,n){d(e,t,n),r()})})});var n=document.createElement("button");n.innerHTML="Pause",n.addEventListener("click",function(){u()}),n.style.display="none";var a=document.createElement("button");a.innerHTML="Resume",a.addEventListener("click",function(){r()}),a.style.display="none";var o=document.createElement("input");o.type="range",o.min="0",o.max="100",o.step="1",o.style.display="block",o.addEventListener("mouseup",function(){s(this.value/100)});var l=document.createElement("input");l.type="range",l.min="1",l.max="100",l.step="1",l.value="1",l.style.display="block",l.addEventListener("mouseup",function(){m(this.value)}),e.appendChild(t),e.appendChild(n),e.appendChild(a),e.appendChild(l),e.appendChild(o),document.body.appendChild(e),setInterval(function(){v&&g&&g.playerState==chrome.cast.media.PlayerState.PLAYING?(l.value=g.getEstimatedTime()/g.media.duration*100,a.style.display="none",n.style.display="inline-block"):v&&g&&g.playerState==chrome.cast.media.PlayerState.PAUSED&&(a.style.display="inline-block",n.style.display="none")},100)}function h(){var e=document.createElement("script");e.src="https://www.gstatic.com/cv/js/sender/v1/cast_sender.js",document.head.appendChild(e)}if(!window.chromecastit){var y=3e5,v=null,g=null;window.__onGCastApiAvailable=function(e,t){e?n():console.log(t)},window.chromecastit=function(e){"main"==e&&(f(),h())}}}();